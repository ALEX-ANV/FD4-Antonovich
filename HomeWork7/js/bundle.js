!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class r{constructor(e,t=3){window.indexedDB||window.alert("IndexedDB doesn't work"),this.provider=window.indexedDB,this.dbName=e,this.version=t,this.key="todo-items",this.indexName="items-id",this.connect()}async connect(){this.db=await this.open()}open(){return new Promise((e,t)=>{let n=this.provider.open(this.dbName,this.version);n.onupgradeneeded=(e=>{e.currentTarget.result.createObjectStore(this.key,{keyPath:"id"}).createIndex(this.indexName,"id",{unique:!0})}),n.onsuccess=(()=>e(n.result)),n.onerror=(()=>t(n.error)),n.onblocked=(()=>{console.log("blocked")})})}set(e){return this.action("readwrite","put",e)}get(e){return new Promise((t,n)=>{this.open().then(r=>{const o=r.transaction([this.key],"readonly").objectStore(this.key).index(this.indexName);o.get(e).onsuccess=(e=>t(e.target.result)),o.get(e).onerror=(e=>n(e.target.error))})})}getAll(){return this.action("readwrite","getAll")}delete(e){return this.action("readwrite","delete",e)}action(e,t,n){return new Promise((r,o)=>{this.open().then(i=>{const a=i.transaction([this.key],e).objectStore(this.key)[t](n);a.onsuccess=(e=>r(e.target.result)),a.onerror=(e=>o(e.target.error))})})}}const o=new class{constructor(){this.provider=new r("todo-list")}async add(e,t){let n=(new Date).getTime().toString(),r={title:e,date:Date.parse(t),id:n,isChecked:!1};return await this.provider.set(r),r}async changeChecked(e){const t=await this.provider.get(e);t.isChecked=!t.isChecked,await this.provider.set(t)}async delete(e){await this.provider.delete(e)}async get(){return(await this.provider.getAll()).sort((e,t)=>t.id-e.id)}},i=document.getElementById("todo-list");i.addEventListener("click",function(e){if(s(e.target,".todo-item-remove-button"))!async function(e){let t=e.getAttribute("id");await o.delete(t),e.parentNode.removeChild(e)}(s(e.target));else{let t=s(e.target);t&&async function(e){c(e),await o.changeChecked(e.getAttribute("id"))}(t)}}),window.addEventListener("load",function(e){!async function(){let e=await o.get();for(var t=0;t<e.length;t++){let n=d(e[t]);i.appendChild(n)}}()});const a=document.forms.addItemForm;function s(e,t=".todo-item"){return e.closest(t)}function d({date:e,title:t,id:n,isChecked:r}){let o=function(){let e=document.getElementById("todo-item-template").cloneNode(!0);return e.removeAttribute("id"),e.classList.remove("hide"),e}().cloneNode(!0);return o.setAttribute("id",n),o.querySelector(".todo-item-title").appendChild(function(e){var t=document.createElement("h1");return t.innerHTML=e,t}(t)),o.querySelector(".todo-item-date").appendChild(function(e){const t=new Intl.DateTimeFormat(navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.userLanguage||navigator.language||navigator.browserLanguage||"ru");var n=document.createElement("span");return n.innerHTML=t.format(e),n}(e)),r&&c(o),o}function c(e){e.querySelector(".todo-item-title").classList.toggle("through-text")}a.addEventListener("submit",function(e){e.preventDefault(),async function(e){let t=d(await o.add(e.get("title"),e.get("date")));i.insertBefore(t,i.firstChild)}(new FormData(a))})}]);